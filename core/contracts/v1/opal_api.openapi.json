{
    "openapi": "3.1.0",
    "info": {
        "title": "OPAL API",
        "description": "Telemetry & Health Service for 02luka OPAL V4 Pipeline",
        "version": "1.1.0"
    },
    "paths": {
        "/api/health": {
            "get": {
                "summary": "Health Check",
                "description": "Basic health check endpoint.",
                "operationId": "health_check_api_health_get",
                "responses": {
                    "200": {
                        "description": "Successful Response",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/HealthResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/status": {
            "get": {
                "summary": "Quick Status",
                "description": "Quick status for other health checks (avoids recursion).",
                "operationId": "quick_status_api_status_get",
                "responses": {
                    "200": {
                        "description": "Successful Response",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/StatusResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/jobs": {
            "post": {
                "summary": "Create Job",
                "description": "Submit a new design pipeline job involving a prompt and an optional artifact.",
                "operationId": "create_job_api_jobs_post",
                "requestBody": {
                    "content": {
                        "multipart/form-data": {
                            "schema": {
                                "$ref": "#/components/schemas/JobCreateRequest"
                            }
                        }
                    },
                    "required": true
                },
                "responses": {
                    "201": {
                        "description": "Job created",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/JobInfo"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/jobs/{id}": {
            "get": {
                "summary": "Poll Job",
                "description": "Retrieve the current status and outputs of a specific job.",
                "operationId": "get_job_api_jobs_id_get",
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Successful Response",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/JobDetail"
                                }
                            }
                        }
                    }
                }
            }
        }
    },
    "components": {
        "schemas": {
            "HealthResponse": {
                "properties": {
                    "status": {
                        "type": "string",
                        "title": "Status"
                    },
                    "timestamp": {
                        "type": "string",
                        "title": "Timestamp"
                    },
                    "service": {
                        "type": "string",
                        "title": "Service",
                        "default": "opal_api"
                    },
                    "version": {
                        "type": "string",
                        "title": "Version",
                        "default": "1.0.0"
                    }
                },
                "type": "object",
                "required": [
                    "status",
                    "timestamp"
                ],
                "title": "HealthResponse"
            },
            "StatusResponse": {
                "properties": {
                    "status": {
                        "type": "string",
                        "title": "Status"
                    },
                    "uptime": {
                        "type": "string",
                        "title": "Uptime",
                        "default": "running"
                    },
                    "port": {
                        "type": "integer",
                        "title": "Port",
                        "default": 7001
                    }
                },
                "type": "object",
                "required": [
                    "status"
                ],
                "title": "StatusResponse"
            },
            "JobCreateRequest": {
                "type": "object",
                "properties": {
                    "prompt": {
                        "type": "string",
                        "description": "Processing instructions / goal"
                    },
                    "file": {
                        "type": "string",
                        "format": "binary",
                        "description": "Target artifact (.obj, .zip, .pdf, .dwg)"
                    },
                    "metadata": {
                        "type": "object",
                        "description": "Optional job metadata"
                    }
                },
                "required": [
                    "prompt",
                    "file"
                ]
            },
            "JobInfo": {
                "type": "object",
                "properties": {
                    "id": {
                        "type": "string"
                    },
                    "status": {
                        "$ref": "#/components/schemas/JobStatus"
                    }
                },
                "required": [
                    "id",
                    "status"
                ]
            },
            "JobDetail": {
                "type": "object",
                "properties": {
                    "id": {
                        "type": "string"
                    },
                    "status": {
                        "$ref": "#/components/schemas/JobStatus"
                    },
                    "outputs": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/JobOutput"
                        }
                    },
                    "error": {
                        "$ref": "#/components/schemas/JobError"
                    }
                },
                "required": [
                    "id",
                    "status"
                ]
            },
            "JobStatus": {
                "type": "string",
                "description": "Deterministic state of the job. See core/semantics/job_lifecycle.md for rules.",
                "enum": [
                    "queued",
                    "running",
                    "succeeded",
                    "failed"
                ]
            },
            "JobOutput": {
                "type": "object",
                "properties": {
                    "path": {
                        "type": "string"
                    },
                    "kind": {
                        "type": "string",
                        "enum": [
                            "model",
                            "image",
                            "log",
                            "artifact"
                        ]
                    }
                },
                "required": [
                    "path",
                    "kind"
                ]
            },
            "JobError": {
                "type": "object",
                "properties": {
                    "message": {
                        "type": "string"
                    }
                },
                "required": [
                    "message"
                ]
            }
        }
    }
}