name: governance-comment-approve

on:
  issue_comment:
    types: [created]

permissions:
  contents: read
  pull-requests: write

jobs:
  approve:
    if: >
      github.event.issue.pull_request != null &&
      contains(github.event.comment.body, '@0luka-bot approve')
    runs-on: ubuntu-latest
    steps:
      - name: Approve PR (minimal)
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.BOT_PAT }}
          script: |
            const pr = await github.rest.pulls.get({
              owner: context.repo.owner,
              repo: context.repo.repo,
              pull_number: context.issue.number
            });

            if (pr.data.user.login !== "Ic1558") {
              core.setFailed("PR author not allowed for bot approval.");
              return;
            }

            await github.rest.pulls.createReview({
              owner: context.repo.owner,
              repo: context.repo.repo,
              pull_number: context.issue.number,
              event: "APPROVE",
              body: "Auto-approved via governance bot (explicit comment trigger)."
            });
